<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HgCdTe Zincblende Structure Viewer</title>
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      background-color: #fafafa;
    }
    #container {
      display: flex;
      height: 100vh;
    }
    #viewer {
      flex: 1;
      position: relative;
    }
    #controls {
      width: 270px;
      padding: 20px;
      background-color: white;
      border-left: 1px solid #eaeaea;
      overflow-y: auto;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.05);
    }
    .control-group {
      margin-bottom: 20px;
    }
    .control-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    button {
      padding: 6px 12px;
      margin: 4px;
      cursor: pointer;
      background-color: #f5f5f5;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      transition: all 0.2s;
      font-size: 14px;
    }
    button:hover {
      background-color: #e9e9e9;
    }
    button.active {
      background-color: #e0e0e0;
      border-color: #c0c0c0;
    }
    .slider {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: #e0e0e0;
      outline: none;
      border-radius: 3px;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #4a90e2;
      cursor: pointer;
    }
    .info-panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      max-width: 300px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }
    .info-panel h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #333;
    }
    .legend {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .legend-color {
      width: 15px;
      height: 15px;
      margin-right: 8px;
      border-radius: 50%;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    hr {
      border: none;
      border-top: 1px solid #eaeaea;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="viewer">
      <div class="info-panel">
        <h3>HgCdTe Zincblende Structure</h3>
        <div id="lattice-info">Lattice constant: 6.46 Å</div>
        <div id="composition-info">Composition: Hg<sub>0.7</sub>Cd<sub>0.3</sub>Te</div>
        <div>Space group: F-43m (216)</div>
        <hr>
        <div class="legend">
          <div class="legend-color" style="background-color:#E000E0;"></div> <div>Hg (Magenta)</div>
        </div>
        <div class="legend">
          <div class="legend-color" style="background-color:#CCCCCC;"></div> <div>Cd (Light Grey)</div>
        </div>
        <div class="legend">
          <div class="legend-color" style="background-color:#33CC33;"></div> <div>Te (Green)</div>
        </div>
      </div>
    </div>
    <div id="controls">
      <h2>Controls</h2>
      <div class="control-group">
        <div class="control-title">Composition (x in Hg₁₋ₓCdₓTe)</div>
        <input type="range" id="composition" class="slider" min="0" max="1" step="0.1" value="0.3">
        <div id="composition-value">x = 0.3</div>
      </div>
      <div class="control-group">
        <div class="control-title">Visualization</div>
        <button id="btn-stick">Stick</button>
        <button id="btn-ball-stick" class="active">Ball & Stick</button>
        <button id="btn-spacefill">Spacefill</button>
      </div>
      <div class="control-group">
        <div class="control-title">Unit Cell</div>
        <button id="btn-show-cell">Show Unit Cell</button>
        <button id="btn-hide-cell" class="active">Hide Unit Cell</button>
      </div>
      <div class="control-group">
        <div class="control-title">Labels</div>
        <button id="btn-show-labels">Show Labels</button>
        <button id="btn-hide-labels" class="active">Hide Labels</button>
      </div>
      <div class="control-group">
        <div class="control-title">Supercell</div>
        <button id="btn-1x1x1" class="active">1×1×1</button>
        <button id="btn-2x2x2">2×2×2</button>
      </div>
      <div class="control-group">
        <div class="control-title">Animation</div>
        <button id="btn-spin">Spin</button>
        <button id="btn-stop">Stop</button>
      </div>
      <div class="control-group">
        <div class="control-title">Export</div>
        <button id="btn-screenshot">Screenshot</button>
      </div>
      <div class="control-group">
        <div class="control-title">Structure Information</div>
        <p><strong>HgCdTe (Hg₁₋ₓCdₓTe)</strong></p>
        <p>- Ternary semiconductor alloy</p>
        <p>- Zincblende structure (F-43m)</p>
        <p>- Used in infrared detectors</p>
        <p>- Bandgap: 0 to 1.5 eV (tunable)</p>
        <p>- Applications: IR imaging, photonics</p>
      </div>
    </div>
  </div>

  <script>
    // Entire script remains unchanged, except here in renderCore():
    function renderCore() {
      viewer.removeAllModels(); viewer.removeAllShapes();
      for (let label of atomLabels) viewer.removeLabel(label); atomLabels = [];
      for (let lineId of cellLines) viewer.removeShape(lineId); cellLines = [];
      if (cellLabel) viewer.removeLabel(cellLabel); cellLabel = null;

      if (!currentAtoms || currentAtoms.length === 0) { viewer.render(); return; }

      let cdRatio = parseFloat($("#composition").val());
      $("#composition-info").html(`Composition: Hg<sub>${(1-cdRatio).toFixed(1)}</sub>Cd<sub>${cdRatio.toFixed(1)}</sub>Te`);
      $("#lattice-info").text(`Lattice constant: ${latticeConstant.toFixed(2)} Å`);

      let model = viewer.addModel();
      model.addAtoms(currentAtoms);
      model.connectBonds(); // ✅ FIX: This enables sticks and ball-and-stick modes

      let style = {};
      const baseStickRadius = 0.1;
      const ballScale = 0.35;
      const stickModeAtomScale = 0.05;
      const atomColors = { "Hg": "#E000E0", "Cd": "#CCCCCC", "Te": "#33CC33" };
      const colorScheme = { prop: 'elem', map: atomColors };

      switch (currentViewStyle) {
        case "stick":
          style = {
            stick: { radius: baseStickRadius, colorscheme: colorScheme },
            sphere: { scale: stickModeAtomScale, colorscheme: colorScheme }
          }; break;
        case "ballAndStick":
          style = {
            stick: { radius: baseStickRadius, colorscheme: colorScheme },
            sphere: { scale: ballScale, colorscheme: colorScheme }
          }; break;
        case "spacefill":
          style = { sphere: { colorscheme: colorScheme } }; break;
      }

      viewer.setStyle({}, style);
      if (cellShown) drawUnitCellOutline();
      if (labelsShown) addAtomLabels();
      viewer.zoomTo(); viewer.render();
    }
  </script>
</body>
</html>
